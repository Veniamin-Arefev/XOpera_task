# Taks main
Необходимо реализовать развёртывание контейнера с nginx в docker на виртуальной машине с помощью TOSCA оркестратора xOpera. xOpera умеет запускать только Ansible, поэтому развёртывание нужно реализовать с помощью Ansible сценариев и привязать их к шаблону.

1) Виртуальную машину нужно поднимать на localhost с помощью Libvirt, Vagrant или другого удобного инструмента. Нужно поддерживать следующие параметры:
- выделенное число CPU
- выделенную память
- выделенный объем диска
- образ виртуальной машины (можно ограничиться ubuntu разных версий)
2) Docker должен устанавливаться на получаемую виртуальную машину и поддерживать выбор версии.
3) Nginx должен запускаться в качестве контейнера в Docker и поддерживать выбор версии. Он должен хостить простую html страницу с текстом, который тоже параметризуется в TOSCA шаблоне и может быть задан пользователем.

Для описания выделенных сущностей нужно создать отдельные типы узлов TOSCA, дополнительно можно описать свои capabilities, relationships, etc. если это необходимо.
Результатом развёртывания будет адрес, который можно открыть в браузере и увидеть заданный пользователем текст.

1) Если пользователь указал неправильные входные данные, он должен получать человекочитаемое сообщение об ошибке чем раньше, тем лучше
2) Нужно поддерживать как развёртывание, так и остановку, удаление ресурсов

Требования к выполнению задачи. Обязательно использовать git  в качестве системы контроля субверсий и не заливать всё одним коммитом; нам нужно видеть историю написания. Проще всего создать проект на гитхабе и вести проект там.

# Taks additional
Задание со звёздочкой: Получаемое решение нужно уметь автоматически тестировать. Можно написать python или bash скрипт, который:
1. сгенерирует рандомом строку
2. запустит xOpera с этим параметром, дождется конца, возьмёт адрес, куда стучаться
3. GET `<address>` | grep `<строка>`
4. запустит xOpera на удаление

# Task in person

Подрять вместо одного nginx сервера - три. Два из них будух хостить так же однострочники, а последний будет выступать в роли reverse proxy. Соответственно запросы по /anek1 /anek2 будут перенаправляться на нужные страницы, которые хостятся в первых друх контейнерах.

# Install guide
0. Create ssh keys named `id_rsa` and add public key in `service.yaml` input default section
1. Install os depencies
2. Change behavior of default virsh net
  ```bash
   virsh net-edit default
  ```
  Add line after `<range...`
  ```
  <host mac='52:54:00:f3:83:87' ip='192.168.122.55'/>
  ```   
3. Install python depencies in virtual env
  ```bash
  . create_venv.sh
  ```
4. Allow sudo for current terminal
  ```bash
  sudo echo 1
  ```
5. Export variables for opera
  ```bash
  . export_creds.sh
  ```
6. Download images
  ```bash
  . check_images_and_download.sh
  ```
7. Run test script
  ```bash
  ./test_this.py
  ```

# Depencies
## Os
* libvirt
* python3
## Python
* pyyaml==5.3.1
* opera
* ansible
* pyjokes
* googletrans==3.1.0a0
* requests
